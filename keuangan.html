<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keuangan RT 06</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>

            /* === GLOBAL === */
    body {
        margin: 0;
        padding: 0;
        font-family: 'Inter', sans-serif;
        background: #f5f8fc;
    }
    
    /* Container utama */
    .container {
        max-width: 900px;
        margin: auto;
        padding: 16px;
    }
    
    /* === CARD === */
    .card {
        background: white;
        border-radius: 18px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0px 4px 20px rgba(0,0,0,0.05);
    }
    
    /* === GRAFIK === */
    .chart-container {
        width: 100% !important;
        height: auto !important;
        max-height: 260px;     /* grafik lebih kecil */
        overflow: hidden;
    }
    canvas {
        width: 100% !important;
        height: auto !important;
    }
    
    /* === GRID HEADER SALDO === */
    .saldo-grid {
        display: flex;
        justify-content: space-between;
        gap: 16px;
    }
    
    .saldo-box {
        flex: 1;
        text-align: center;
    }
    
    /* === TABEL === */
    .table-responsive {
        width: 100%;
        overflow-x: auto;        /* Supaya tidak pecah di HP */
    }
    
    table {
        width: 100%;
        border-collapse: collapse;
        min-width: 600px;        /* Tabel tidak menyempit */
    }
    
    th, td {
        padding: 8px 12px;
        border-bottom: 1px solid #e8e8e8;
        font-size: 14px;
        white-space: nowrap;
    }
    
    /* ========================================= */
    /* === MOBILE RESPONSIVE BREAKPOINT (<480px) */
    /* ========================================= */
    @media (max-width: 480px) {
    
        h1, h2, h3, h4 {
            text-align: center;
        }
    
        .container {
            padding: 10px;
        }
    
        .card {
            padding: 14px;
            border-radius: 14px;
        }
    
        /* Grid saldo jadi kolom */
        .saldo-grid {
            flex-direction: column;
        }
    
        .saldo-box {
            text-align: center;
        }
    
        /* Grafik lebih kecil */
        .chart-container {
            max-height: 200px;
        }
    
        /* Progress bar mengecil */
        .progress-bar {
            height: 8px !important;
        }
    
        table {
            font-size: 12px;
            min-width: 480px; /* agar tidak terlalu mepet */
        }
        
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background: #f5f7fa;
            color: #333;
        }

        .container {
            width: 100%;
            max-width: 900px;
            margin: auto;
            padding: 12px;
        }

        .card {
            background: white;
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 18px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.07);
        }

        h2 {
            margin: 0 0 12px;
            font-size: 18px;
            font-weight: 700;
            color: #2c3e50;
            text-align: center;
        }

        /* ---- FIX RESPONSIVE HP ---- */
        .chart-container {
            position: relative;
            width: 100% !important;
            max-width: 100% !important;
            height: 330px;
            overflow: hidden;
        }

        canvas {
            width: 100% !important;
            height: 100% !important;
        }

        /* HP MODE */
        @media(max-width: 600px) {

            .container {
                padding: 8px;
            }

            .card {
                padding: 14px;
            }

            h2 {
                font-size: 16px;
            }

            .chart-container {
                height: 240px !important; /* ukuran ideal HP */
            }
        }
    </style>
</head>
<body>

<div class="container">

    <div class="card">
        <h2>Grafik Pemasukan & Pengeluaran per Kategori</h2>
        <div class="chart-container">
            <canvas id="kategoriChart"></canvas>
        </div>
    </div>

</div>

<script>
const SHEET_URL_PEMASUKAN =
 "https://opensheet.elk.sh/1EMYpie82paCl-vupfhyj11Z9tNGFp2p7aIDwIIl_Z0o/web_Pemasukan";

const SHEET_URL_PENGELUARAN =
 "https://opensheet.elk.sh/1EMYpie82paCl-vupfhyj11Z9tNGFp2p7aIDwIIl_Z0o/web_Pengeluaran";

async function ambilData() {
    const [pemasukanRes, pengeluaranRes] = await Promise.all([
        fetch(SHEET_URL_PEMASUKAN),
        fetch(SHEET_URL_PENGELUARAN)
    ]);

    const pemasukan = await pemasukanRes.json();
    const pengeluaran = await pengeluaranRes.json();

    // Hitung total per kategori
    const totalMasuk = {};
    const totalKeluar = {};

    pemasukan.forEach(row => {
        const kategori = row.Kategori?.trim();
        const nominal = parseInt(row.Nominal || "0");

        if (kategori) {
            totalMasuk[kategori] = (totalMasuk[kategori] || 0) + nominal;
        }
    });

    pengeluaran.forEach(row => {
        const kategori = row.Kategori?.trim();
        const nominal = parseInt(row.Nominal || "0");

        if (kategori) {
            totalKeluar[kategori] = (totalKeluar[kategori] || 0) + nominal;
        }
    });

    // Gabungkan kategori
    const semuaKategori = Array.from(new Set([
        ...Object.keys(totalMasuk),
        ...Object.keys(totalKeluar)
    ])).sort(); // A-Z

    const dataMasuk = semuaKategori.map(k => totalMasuk[k] || 0);
    const dataKeluar = semuaKategori.map(k => totalKeluar[k] || 0);

    buatChart(semuaKategori, dataMasuk, dataKeluar);
}

function buatChart(labels, masuk, keluar) {
    const ctx = document.getElementById("kategoriChart");

    new Chart(ctx, {
        type: "line",
        data: {
            labels: labels,
            datasets: [
                {
                    label: "Pemasukan",
                    data: masuk,
                    borderColor: "#2ecc71",
                    backgroundColor: "rgba(46, 204, 113, 0.25)",
                    borderWidth: 3,
                    tension: 0.35
                },
                {
                    label: "Pengeluaran",
                    data: keluar,
                    borderColor: "#e74c3c",
                    backgroundColor: "rgba(231, 76, 60, 0.25)",
                    borderWidth: 3,
                    tension: 0.35
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: "top" }
            },
            scales: {
                x: {
                    ticks: { maxRotation: 45, minRotation: 0 }
                },
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

ambilData();
</script>

</body>
</html>
